<!DOCTYPE html>
<html>

<head>
  <title>360DashPlayer</title>

  <!-- 
  
  <script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
  <script src="js/arrow-key-rotation.js"></script>
  <script src="js/play-on-window-click.js"></script>
  <script src="js/play-on-vrdisplayactivate-or-enter-vr.js"></script>
  <script src="js/hide-once-playing.js"></script>
  <script type="text/javascript" src="js/demo_player.js"></script>
  <script type="text/javascript" src="libs/iso_boxer.min.js"></script>
  <script type="text/javascript" src="libs/hevc_merger.js"></script>
  <script type="text/javascript" src="libs/Chart.bundle.min.js"></script>
  -->

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.dashjs.org/latest/dash.all.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>	
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="css/style.css">

</head>

<body>
  <div id="app">
      <div class="container">
          <!-- HEVC -->
          <div v-if='isHEVCSupported()'>
          <div class="row">
            <div class="col-sm" v-for="video in h265">
              <div v-if="is360Stream(video)">
                <div v-if="video.showScene">
                  <a-scene start="Scene is ready">
                    <a-assets>
                      <video id="dashjs" class="player" controls autoplay="" webkit-playsinline></video>
                    </a-assets>
                    <a-videosphere id="videosphere" src="#dashjs"></a-videosphere>
                  </a-scene>    
                </div>
                <div v-else>
                  <video data-dashjs-player v-bind:src="video.url" v-on:click="showScene(video)" webkit-playsinline></video>
                </div>
              </div>
              <div v-else>
                <video data-dashjs-player controls autoplay="" v-bind:src="video.url" webkit-playsinline></video>
              </div>
            </div>
          </div>
          </div>

          <!-- AVC -->
          <div v-else>
            <div class="row">
              <div class="col-sm" v-for="video in h264">
                <div v-if="is360Stream(video)">
                  <div v-if="video.showScene">
                    <a-scene start="Scene is ready">
                      <a-assets>
                        <video id="dashjs" class="player" controls autoplay="" webkit-playsinline></video>
                      </a-assets>
                      <a-videosphere id="videosphere" src="#dashjs"></a-videosphere>
                    </a-scene>    
                  </div>
                  <div v-else>
                    <video data-dashjs-player v-bind:src="video.url" v-on:click="showScene(video)" webkit-playsinline></video>
                  </div>
                </div>
                <div v-else>
                  <video data-dashjs-player controls autoplay="" v-bind:src="video.url" webkit-playsinline></video>
                </div>     
              </div>
            </div>
          </div>
      </div>
  </div>
      

  <script>

 

    var app = new Vue({
      el:'#app',
      data: {
        h265 : [
         { 
            omnidirectional : false,
            url : "http://h2857701.stratoserver.net/360DashPlayer/media/2019_Fehrbellin/h265/fehrbellin.mpd",
            playing: false,
            showScene : false
         },
        { 
            omnidirectional: false,
            url : "http://h2857701.stratoserver.net/360DashPlayer/media/2019_Fuerteventura/h265/fuerteventura.mpd",
            playing: false,
            showScene : false
        },
        {
          omnidirectional: true,
          url : "http://h2857701.stratoserver.net/360DashPlayer/media/2019_Oberwiesenthal/h265/oberwiesenthal.mpd",
          playing: false,
          showScene : false
        }
      ],
      h264 : [
      { 
        omnidirectional : false,
        url : "http://h2857701.stratoserver.net/360DashPlayer/media/2019_Fehrbellin/h264/fehrbellin.mpd",
        playing: false,
        showScene : false
     },
    { 
        omnidirectional: false,
        url : "http://h2857701.stratoserver.net/360DashPlayer/media/2019_Fuerteventura/h264/fuerteventura.mpd",
        playing: false,
        showScene : false
    },
    {
      omnidirectional: true,
      url : "http://h2857701.stratoserver.net/360DashPlayer/media/2019_Oberwiesenthal/h264/oberwiesenthal.mpd",
      playing: false,
      showScene : false
    }
      ]
      },
      methods:{
        isHEVCSupported: function(){
          let video;
      
          if(!video) {
            video = document.createElement('video')
          }
    
          let h265 = video.canPlayType('video/mp4; codecs="hev1.1.6.L186.80"');
          if(h265 === 'probably' || h265 === 'maybe'){
            console.log("HEVC is supported.");
            return true;
          }
          console.log("H.265/HEVC is not supported. Use H.264/AVC.")
          return false;
        },
      is360Stream: function(stream){
        console.log(stream.omnidirectional);
        if(stream.omnidirectional){
          return true;
        } else {
          return false;
        }
      },
      showScene: function(stream){
        stream.showScene = true;
        console.log('showScene()');
        AFRAME.registerComponent('start', {
          schema: {type: 'string'},
        
          init: function () {
            var stringToLog = this.data;
            console.log(stringToLog);
            var playerElement = $('#dashjs');
            playerElement.show();
    
            console.log("Player element: ",playerElement[0]);
          
            var player = dashjs.MediaPlayer().create();
            console.log('Created DASH.js Player: '+JSON.stringify(player));
          
            player.initialize(document.querySelector('#dashjs'),stream.url, true);
            console.log('Starting playback');
            console.log('Set player source');
          }
        });
      }
    }
    });
  </script>
</body>
</html>
